---
globs: *.nix, **/*.nix
alwaysApply: false
description: Package management best practices
---
# NixOS Package Management

## Never Use Imperative Installation
**Avoid `nix profile install` on NixOS.**
Rationale: Breaks declarative reproducibility.

**Correct patterns:**
- **Permanent packages**: `environment.systemPackages` or Home Manager
- **One-off tools**: `nix shell nixpkgs#ffmpeg` (temporary)
- **Execute once**: `nix run nixpkgs#cowsay -- "hello"` (no install)
- **Development**: `nix develop` with flake devShells

## Search Priority
1. **Options first**: https://search.nixos.org/options (integrated services)
2. **Packages second**: https://search.nixos.org/packages or `nix search`
3. **Nixpkgs source grep**: Many packages poorly indexed

## Temporary Environments
```bash
# Shell with packages available
nix shell nixpkgs#python3 nixpkgs#nodejs
# Run command directly
nix run nixpkgs#hello
# Development environment (with flake.nix)
nix develop
```

**Detailed patterns:** See [NIXOS-PATTERNS.md](NIXOS-PATTERNS.md)
